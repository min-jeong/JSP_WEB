<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<style>
.c {
	text-align: center;	
}
</style>
<script type="text/javascript">
	$(document).ready( function() {
		$(".hide").hide();
		$("#recommends").click( function() {
			
	        	$.get("/recommends?articleId=${selectedArticle.articleId}", function(){
	            alert("추천 완료");
	            
	        }); 

		});

 		$("#delete").click( function() {
 			
 			location.href="/delete?articleId=${ selectedArticle.articleId }";
 			
		}); 

 		$("#modify").click( function() {
 			
 			location.href="/modify?articleId=${ selectedArticle.articleId }";
 			
		}); 
		$("#download").click( function() {
			location.href="/fileDownload?fileName=${ file.fileName }";
		});
		
		$("#list").click( function() {
			location.href="/list";
		});
		
		$("#writeReplyBtn").click( function() {
			var form = $("#wirteReplyForm");
			
			form.attr("method", "POST");
			form.attr("action", "/doWriteReply");
			
			form.submit();
		});
		
		$(".writeReReply").click( function() {
			var table = $(this).parent().parent().parent(); // this 는 현재 클릭한 것 writeReReply
			console.log(table.text());
			
			var groupId = table.children(":eq(1)").children(":eq(0)").html();
			var parentReplyId = table.children(":eq(1)").children(":eq(1)").html();
			var depth = table.children(":eq(2)").children(":eq(0)").html();
			var orderNo = table.children(":eq(2)").children(":eq(1)").html();
			var replyId = table.children(":eq(3)").children(":eq(0)").html();
			
			$("#depth").val(parseInt(depth) + 1); // 대댓글이라는 것을 알려주기 위해서
			$("#parentReplyId").val(replyId);
			$("#groupId").val(groupId);
			$("#orderNo").val(orderNo);
			
		});
	}) ;
	
</script>
<br/>
<br/>
<table border="1" width="800px" align="center">
	<tr>
		<th>글 번호</th>
		<th>글 제목</th>
		<th>글쓴이 Nick</th>
		<th>글쓴이 ID</th>
		<th>글 내용</th>
		<th>조회수</th>
		<th>추천수</th>
	</tr>
	
	<tr>
		<td class="c">${ selectedArticle.articleId }</td>
		<td class="c">${ selectedArticle.title }</td>
		<td class="c">${ selectedArticle.nickName }</td>
		<td class="c">${ selectedArticle.memberId }</td>
		<td class="c">${ selectedArticle.descript }</td>
		<td class="c">${ selectedArticle.hits }</td>
		<td class="c">${ selectedArticle.recommends }</td>
	</tr>
	<tr>
	
	<c:forEach items="${ selectedArticle.fileList }" var="file">
		<th>첨부파일</th>
		<td colspan="6" class="c">
		<a href="/download?fileId=${ file.fileId }&articleId=${ selectedArticle.articleId }">
			${ file.fileName }</a>
		</td>
	</c:forEach>
</table>

<%-- 세션 접근
${ sessionScope._MEMBER_.memberId }
${ sessionScope._MEMBER_.nickName }
${ sessionScope._MEMBER_.password }
${ sessionScope._MEMBER_.email } --%>

<c:set var="loginId" value="${ sessionScope._MEMBER_.memberId }" />

<form id="wirteReplyForm" align="center" top-margin="10px">
	<input type="hidden" id="articleId" name="articleId" value="${ selectedArticle.articleId }" />
	<input type="hidden" id="depth" name="depth" value="0" />
	<input type="hidden" id="parentReplyId" name="parentReplyId" value="0" />
	<input type="hidden" id="groupId" name="groupId" value="0" />
	<input type="hidden" id="orderNo" name="orderNo" value="0" />
	<textarea id="description" name="description" ></textarea>
	<input type="button" id="writeReplyBtn" width="800px" value="댓글 등록" />
</form>

<div>
<c:forEach items="${ selectedArticle.replyList }" var="reply">
<table border="1" width="60%">
	<tr>
		<td>${ reply.nickName }</td>
		<td>
			${ reply.description }<br/>
			<span class="writeReReply">댓글달기</span>
		</td>
	</tr>
	<tr>
		<td class="groupId">${ reply.groupId }</td>
		<td class="parentReplyId">${ reply.parentReplyId }</td>
	</tr>
	<tr>
		<td class="depth">${ reply.depth }</td>
		<td class="orderNo">${ reply.orderNo }</td>
	</tr>
	<tr>
		<td class="replyId">${ reply.replyId }</td>
	</tr>
</table>
</c:forEach>
</div>
<table border="1" align="center">
	<tr align="center">
		<td colspan="3">메뉴</td>
	</tr>
	<tr>
		<td align="center"><input type="button" id="recommends" value="추천" /></td>
		<c:if test="${ loginId eq selectedArticle.memberId }">
			<td>
				<input type="button" id="delete" value="삭제" />
				<input type="button" id="modify" value="수정" />
			</td>
		</c:if>
		<td>
			<input type="button" id="list" value="목록" />
		</td>
	</tr>
</table>


